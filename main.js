(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,s){var u=e._id,a=e.name,c=e.link,l=e.likes,f=e.owner;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardSelector=r,this._id=u,this._title=a,this._src=c,this._likes=l,this._currentUserId=n,this._isOwner=this._currentUserId===f._id,this._popupHandler=o,this._deleteHandler=i,this._likeHandler=s,this._handleCardClick=this._handleCardClick.bind(this),this._handleLikeButton=this._handleLikeButton.bind(this),this._handleDeleteButton=this._handleDeleteButton.bind(this)}var n,r;return n=t,(r=[{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._imageElement=this._element.querySelector(".card__image"),this._titleElement=this._element.querySelector(".card__title"),this._likesElement=this._element.querySelector(".card__like-counter"),this._likeButtonElement=this._element.querySelector(".button_type_like"),this._deleteButtonElement=this._element.querySelector(".button_type_delete"),this._titleElement.textContent=this._title,this._imageElement.src=this._src,this._imageElement.alt=this._title,this._likesElement.textContent=this._likes.length,this.isLikedBy(this._currentUserId)&&this._likeButtonElement.classList.add("button_type_like_active"),this._setEventListeners(),this._element}},{key:"getElement",value:function(){return this._element}},{key:"isLikedBy",value:function(e){return this._likes.find((function(t){return t._id===e}))}},{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_handleDeleteButton",value:function(){this._deleteHandler()}},{key:"_handleLikeButton",value:function(){var e=this;this._likeHandler().then((function(t){e._likes=t.likes,e._likesElement.textContent=e._likes.length,e.isLikedBy(e._currentUserId)?e._likeButtonElement.classList.add("button_type_like_active"):e._likeButtonElement.classList.remove("button_type_like_active")})).catch((function(e){return console.log(e)}))}},{key:"_handleCardClick",value:function(){this._popupHandler(this._src,this._title)}},{key:"_setEventListeners",value:function(){this._likeButtonElement.addEventListener("click",this._handleLikeButton),this._isOwner?this._deleteButtonElement.addEventListener("click",this._handleDeleteButton):this._deleteButtonElement.remove(),this._imageElement.addEventListener("click",this._handleCardClick)}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){var r=t.inputSelector,o=t.submitButtonSelector,i=t.inactiveButtonClass,s=t.inputErrorClass;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=n,this._inputSelector=r,this._inactiveButtonClass=i,this._inputErrorClass=s,this._inputList=this._getInputList(),this._submitButton=this._formElement.querySelector(o)}var t,r;return t=e,(r=[{key:"_getInputList",value:function(){return Array.from(this._formElement.querySelectorAll(this._inputSelector))}},{key:"_disableButton",value:function(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.setAttribute("disabled","")}},{key:"_showInputError",value:function(e,t){this._formElement.querySelector("#".concat(e.name,"-error")).textContent=t}},{key:"_hideInputError",value:function(e){this._formElement.querySelector("#".concat(e.name,"-error")).textContent=""}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this._disableButton():(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.removeAttribute("disabled"))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?(e.classList.remove(this._inputErrorClass),this._hideInputError(e)):(e.classList.add(this._inputErrorClass),this._showInputError(e,e.validationMessage))}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_setEventListeners",value:function(){var e=this;this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._formElement.addEventListener("reset",(function(t){e._inputList.forEach((function(t){t.classList.remove(e._inputErrorClass),e._hideInputError(t)})),e._disableButton()})),this._inputList.forEach((function(t){t.addEventListener("input",(function(t){e._checkInputValidity(t.target),e._toggleButtonState()})),t.addEventListener("change",(function(t){e._checkInputValidity(t.target),e._toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this._setEventListeners(),this._toggleButtonState()}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._pageElement=document.querySelector(".page"),this._popup=document.querySelector(t),this._popupCloseButton=this._popup.querySelector(".button_type_close"),this.handleEscClose=this._handleEscClose.bind(this),this.handleOverlayClose=this._handleOverlayClose.bind(this),this.close=this.close.bind(this),this.open=this.open.bind(this),this._popupCloseButton.addEventListener("click",this.close),this._popup.addEventListener("click",this.handleOverlayClose)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),this._pageElement.classList.add("page_no-overflow"),this._setEventListeners()}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),this._pageElement.classList.remove("page_no-overflow"),this._removeEventListeners()}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleOverlayClose",value:function(e){e.target===this._popup&&this.close()}},{key:"_setEventListeners",value:function(){document.addEventListener("keydown",this.handleEscClose)}},{key:"_removeEventListeners",value:function(){document.removeEventListener("keydown",this.handleEscClose)}}])&&o(t.prototype,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function s(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=i.call(this,e))._submitHandler=t,r._submitForm=r._submitForm.bind(f(r)),r._form=r._popup.querySelector(".form"),r.submitButton=r._form.querySelector(".button_type_save"),r.close=r.close.bind(f(r)),r._options=n||{},r._options.resetOnClose=void 0===r._options.resetOnClose||r._options.resetOnClose,r}return t=s,(n=[{key:"close",value:function(){this._options.resetOnClose?(this._form.reset(),a(h(s.prototype),"close",this).call(this)):a(h(s.prototype),"close",this).call(this)}},{key:"_submitForm",value:function(){var e=this._getInputValues();this._submitHandler(e)}},{key:"_getInputValues",value:function(){return this._form.elements}},{key:"_setEventListeners",value:function(){this._form.addEventListener("submit",this._submitForm),a(h(s.prototype),"_setEventListeners",this).call(this)}},{key:"_removeEventListeners",value:function(){this._form.removeEventListener("submit",this._submitForm),a(h(s.prototype),"_removeEventListeners",this).call(this)}}])&&u(t.prototype,n),s}(i);function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this,e))._image=t._popup.querySelector(".image-popup__image"),t._title=t._popup.querySelector(".image-popup__title"),t}return t=s,(n=[{key:"open",value:function(e,t){this._image.src=e,this._title.textContent=t,m(b(s.prototype),"open",this).call(this)}}])&&p(t.prototype,n),s}(i);function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._items.forEach((function(t){return e._renderer(t)}))}},{key:"addItem",value:function(e){this._items.unshift(e),this._container.prepend(this._renderer(e))}},{key:"removeElementById",value:function(e){this._items.find((function(t){return t._id===e})).getElement().remove(),this._items.splice(this._items.findIndex((function(t){return t._id===e})),1)}}])&&E(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){var n=t.nameSelector,r=t.aboutSelector,o=t.imageSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameElement=document.querySelector(n),this._aboutElement=document.querySelector(r),this._imageElement=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserId",value:function(){return this._id}},{key:"getUserInfo",value:function(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,src:this._imageElement.src}}},{key:"setUserInfo",value:function(e){var t=e._id,n=e.name,r=e.about,o=e.avatar;t&&(this._id=t),o&&(this._imageElement.src=o),this._nameElement.textContent=n,this._aboutElement.textContent=r,this._imageElement.alt="".concat(n,"; ").concat(r)}}])&&C(t.prototype,n),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t.baseUrl,this.headers=t.headers}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}},{key:"getUserInfo",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{method:"GET",headers:this.headers}).then(this._checkResponse)}},{key:"updateUserInfo",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}},{key:"fetchCards",value:function(){return fetch("".concat(this.baseUrl,"/cards"),{method:"GET",headers:this.headers}).then(this._checkResponse)}},{key:"createCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:n})}).then(this._checkResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}},{key:"likeCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then(this._checkResponse)}},{key:"dislikeCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}},{key:"updateUserAvatar",value:function(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}])&&S(t.prototype,n),e}(),L={inputSelector:".form__text-field",submitButtonSelector:".button_type_save",inactiveButtonClass:"button_type_save_disabled",inputErrorClass:"form__text-field_type_error"},O=Array.from(document.forms),I=document.querySelector(".button_type_edit"),U=document.querySelector(".avatar__edit"),j=(document.forms["edit-avatar-form"].elements.field__avatar,document.forms["edit-form"]),P=j.elements.fieldName,R=j.elements.fieldAbout,x=document.querySelector(".button_type_add");document.forms["add-form"],document.forms["confirm-delete-form"],O.forEach((function(e){new r(L,e).enableValidation()}));var q=new B({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-22",headers:{authorization:"bedcf061-ec3c-4659-8ef2-ecacae078c05","Content-Type":"application/json"}}),T=new k(".image-popup"),A=new d(".confirm-delete-popup",(function(e){console.log(e);var t=A.cardId;q.deleteCard(t).then((function(){H.removeElementById(t),A.close()})).catch((function(e){return console.log(e)}))}),{resetOnClose:!1}),D=function(e,n){return new t(e,n,"#card-template",T.open,(function(){return t=e,A.cardId=t._id,void A.open();var t}),(function(){return this.isLikedBy(N.getUserId())?q.dislikeCard(e._id).then((function(e){return e})):q.likeCard(e._id).then((function(e){return e}))}))},H=new g({items:[],renderer:function(e){return e.generateCard()}},".elements"),V=new d(".add-popup",(function(e){var t=V.submitButton.textContent;V.submitButton.textContent="Сохранение...",function(e){return q.createCard({name:e.fieldTitle.value,link:e.fieldLink.value}).then((function(e){H.addItem(D(e,N.getUserId()))})).catch((function(e){return console.log(e)}))}(e).then((function(){V.close(),V.submitButton.textContent=t})).catch((function(e){return console.log(e)}))}));x.addEventListener("click",V.open);var N=new w({nameSelector:".profile-info__name",aboutSelector:".profile-info__about",imageSelector:".avatar__image"});q.getUserInfo().then((function(e){N.setUserInfo(e),q.fetchCards().then((function(t){t.sort((function(e,t){var n=new Date(e.createdAt),r=new Date(t.createdAt);return r>n?-1:r<n?1:0})).forEach((function(t){return H.addItem(D(t,e._id))}))}))})).catch((function(e){return console.log(e)}));var F=new d(".edit-popup",(function(e){var t=F.submitButton.textContent;F.submitButton.textContent="Сохранение...",function(e){return console.log(e),q.updateUserInfo(e.fieldName.value,e.fieldAbout.value).then((function(e){N.setUserInfo({name:e.name,about:e.about})})).catch((function(e){return console.log(e)}))}(e).then((function(){F.close(),F.submitButton.textContent=t})).catch((function(e){return console.log(e)}))}));I.addEventListener("click",(function(){var e=N.getUserInfo();F.open(),P.value=e.name,P.dispatchEvent(new InputEvent("input")),R.value=e.about,R.dispatchEvent(new InputEvent("input"))}));var J=new d(".edit-avatar-popup",(function(e){var t=J.submitButton.textContent;J.submitButton.textContent="Сохранение...",q.updateUserAvatar(e.fieldAvatar.value).then((function(e){N.setUserInfo(e),J.close(),J.submitButton.textContent=t})).catch((function(e){return console.log(e)}))}));U.addEventListener("click",(function(){J.open()}))})();